<!doctype html>
<html>
  <head>
    <title>Bluesky WebSocket Test</title>
  </head>
  <body>
    <h1>Bluesky Jetstream WebSocket Test</h1>
    <div id="status">Connecting...</div>
    <div id="messages"></div>

    <script>
      const ws = new WebSocket(
        "wss://jetstream1.us-east.bsky.network/subscribe?wantedCollections=app.bsky.feed.post",
      );
      const status = document.getElementById("status");
      const messages = document.getElementById("messages");
      let messageCount = 0;

      ws.onopen = () => {
        status.textContent = "âœ… Connected to Jetstream!";
        console.log("WebSocket connected");
      };

      ws.onmessage = (event) => {
        messageCount++;
        const data = JSON.parse(event.data);
        console.log("Received:", data);

        // Show first 5 messages
        if (messageCount <= 5) {
          const div = document.createElement("div");
          div.style.marginTop = "10px";
          div.style.padding = "10px";
          div.style.backgroundColor = "#f0f0f0";
          div.style.borderRadius = "5px";
          div.innerHTML = `
                    <strong>Message ${messageCount}:</strong><br>
                    Type: ${data.kind}<br>
                    Collection: ${data.commit?.collection}<br>
                    DID: ${data.did}
                `;
          messages.appendChild(div);
        } else if (messageCount === 6) {
          const div = document.createElement("div");
          div.style.marginTop = "10px";
          div.textContent = `Continuing to receive messages... (${messageCount} total)`;
          messages.appendChild(div);
        } else {
          messages.lastElementChild.textContent = `Continuing to receive messages... (${messageCount} total)`;
        }
      };

      ws.onerror = (error) => {
        status.textContent = "âŒ WebSocket error!";
        console.error("WebSocket error:", error);
      };

      ws.onclose = () => {
        status.textContent = "ðŸ”Œ WebSocket closed";
        console.log("WebSocket closed");
      };
    </script>
  </body>
</html>
